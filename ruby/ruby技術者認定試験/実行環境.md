Rubyチュートリアル
================



## 慣れることを目的としたスクリプト実行



## irbの起動

```ruby
$ irb
>>
```



## 変数と定数

### 変数
何度でも値を変更できる

```ruby
>> a = 1
>> print a + 1
2=> nil
>> a = 3
=> 3
```

> 変数の型(stringなど)を指定していなくても、値が型の情報を管理する
>
> →動的型言語

色々なコード

```ruby
>> a = 1
=> 1
>> a = "ruby"
=> "ruby"
>> print a
ruby=> nil
```

空白を用意した場合

```ruby
>> a = 1
=> 1
>> print ( a + 1 )
2=> nil
>>
```



### 定数

変更の際に警告が出てくる。基本的に値を変更しない。

```ruby
>> A = 1
=> 1
>> print A + 1
2=> nil
>> A = 2
(irb):5: warning: already initialized constant A
(irb):3: warning: previous definition of A was here
=> 2
```



## 関数とクラス

### 関数

```ruby
>> def add(a, b)
>>   a + b
>> end
=> :add
>> print add(1, 2)
3=> nil
```

省略した形

```ruby
>> def add(a, b); a + b; end
=> :add
>> print add(1, 2)
3=> nil
```



### クラス

```ruby
>> class Hoge                #クラスHogeの定義
>>   def test                #testメソッドの定義
>>     1
>>   end
>> end
=> :test
>> hoge = Hoge.new           #Hogeクラスのインスタンスを生成
=> #<Hoge:0x007ff3890a5ad0>
>> hoge.test                 #Hogeクラスのtestメソッドを実行
=> 1
```



## コマンドラインオプションと環境変数

そもそも、プログラムとは…

* コンピュータに対する命令を記述したもの

* コンピュータが解釈できるのは「0」と「１」の羅列だけ。(「0」と「1」というのはそれぞれ電圧が「ない」か「ある」かに対応)

そのためには、コンピュータが読み取れる **アセンブリ言語** に変更する必要がある

→アセンブリ言語と機械語の仲介を行うのがアセンブラ

私たちが使用している言語は、 **高水準言語** (Ruby、Python、Cなど)

要するに、

1. 高水準言語→アセンブリ言語

1. アセンブリ言語→機械語

の変換が必要になる。


**コンパイラ**

* 高水準の言語を、機械語、あるいはより低水準の言語に翻訳する機能を持っている

* C言語→コンパイラ→アセンブリ言語→アセンブラ→機械語 のプロセス

* ソースコードを書いてコンパイル（翻訳）し、実行してみるということをしなければ振る舞いを実際に見ることはできない

* 全部翻訳してから実行するため、機械語に翻訳済みなら高速


**インタプリタ**

* コンパイラのように機械語に翻訳だけでなく、実際に実行するところまでを管理する

* Ruby→インタプリタ→機械語→実行結果

* 特徴としては、実行が上手くいかなかった時点で、すぐにデバッグに取り掛かれる

* 一行ずつ翻訳と実行をするため、実行速度が比較的低速

irb・・・短いスクリプトを試すためのもの

→インタプリタを自分の手で行なっていた

インプリンタ・・・本格的なスクリプトの実行

→一行ずつ翻訳と実行を行なってもらう！！

***

### 組み込み定数とコマンドラインオプション

インタプリタの場所・・・Rubyのインストールフォルダのbinに「ruby」という名前で格納

→コマンドラインから「ruby」と入力することで起動

コードの例

`test.rb`

```ruby
p "Hello Ruby"  #=> "Hello Ruby"
p ARGV[0]       # コマンドラインの引数を出力
p ENV["PATH"]   #=> 実行したPCの環境変数PATHの値を出力
```

`ターミナル上での動き`

```ruby
$ ruby test.rb 1
"Hello Ruby"
"1"
"/Users/MacUser/.rbenv/versions/2.4.1/bin:/usr/local/Cellar/" # 省略
```

〜解説〜
1. `Hello Ruby`の出力

1. `ARGV[0]`はコマンドラインの出力

1. `ENV["PATH"]`は環境変数PATHの出力(引数「1」を出力)



#### 組み込み定数

##### STDIN

標準入力を受け取るオブジェクト

端末に関連づけられていて、キーボードからの入力を受け取ることができる

レシーバーを指定しない`gets`などのメソッドは、標準入力からのデータを受け取る

`test.rb`

```ruby
str = STDIN.gets
p str
```

`ターミナル上での動き`

```ruby
$ ruby test.rb
hoge
"hoge\n"
```



##### STDOUT

標準出力に対応するオブジェクト

標準出力への書き込みは、端末画面に向けられている。

レシーバーを指定しない`puts`、`print`、`printf`などのメソッドは、標準出力への出力となる

`test.rb`

```ruby
STDOUT.puts "STDOUT!"
```

`ターミナル上での動き`

```ruby
$ ruby test.rb
STDOUT!
```



##### STDERR

標準エラー出力に対応するオブジェクト

標準エラー出力への書き込みは、端末画面に向けられている

標準出力と同じように思われるが、実際は警告やエラーに限らず、

プログラムの正常な出力とは分離しておきたいメッセージを出力する為に使用される

`test.rb`

```ruby
STDERR.puts "STDERR!"
```

`ターミナル上での動き`

```ruby
$ ruby test.rb
STDERR!

```



##### ENV

環境変数を表すオブジェクト

`test.rb`

```ruby
home = ENV['HOME']
p "user home = #{home}"
```

`ターミナル上での動き`

```ruby
$ ruby test.rb
"user home = /Users/MacUser"
```

##### ARGF

引数で作られる、仮想ファイルを表すオブジェクト

`test.rb`

```ruby
a
b
c
```

`test2.rb`

```ruby
p ARGF.filename
while line = ARGF.gets
  p line
end
```

`ターミナル上での動き`

```ruby
$ ruby ./test2.rb ./test.rb
"./test.rb"                  #ファイル名を取得して出力
"a\n"                        #一行ずつ読み込んだものを出力
"b\n"
"c\n"
```

##### ARGV

Rubyスクリプトに与えられた引数を表す配列

与えらた引数が配列で出力

`test.rb`

```ruby
p ARGV
```

`ターミナル上での動き`

```ruby
$ ruby test.rb 111 222 333
["111", "222", "333"]
```

##### DATA

`__END__`以降をアクセスするFileオブジェクト

 →`__END__`は Ruby スクリプトの終わりを表すキーワード(これ以上はスクリプトとして読み込めない)

 `test.rb`

 ```ruby
 p DATA.gets
p DATA.gets
p DATA.gets

 __END__
aaaa
bbb
ccc
 ```

例)

 ```ruby
 while not DATA.eof?
   lines = DATA.readlines
   lines.map(&:chomp!)
   lines.reverse           # 非破壊メソッド
   p lines
 end

 __END__
 1
 2
 3
 4

 # 解答
 ["1", "2", "3", "4"]
 ```



#### rubyインタプリタの実行

```ruby
ruby [オプション][--][プログラムファイル][引数]
```

##### 主なコマンドラインオプション

* `-h`：ヘルプの表示

* `-v`：rubyのバージョンの表示

* `-c`：指定されたファイルが文法的に正しいかを確認(実行しない)

* `-e`：指定された文字列をrubyプログラムとして実行

* `-r`：スクリプト実行時に、指定されたファイルを実行する

* `-d`：デバックモードでの実行

* `-w`：冗長モードでの出力

* `-l`：`$LOAD_PATH`に、指定された文字列を追加

例)冗長モードの出力
`test.rb`

```ruby
a = 3
b = 2
puts a
```

`ターミナル上`

```ruby
$ ruby -w test.rb  #冗長モードでの出力
test.rb:2: warning: assigned but unused variable - b
3

$ ruby -W test.rb  #全ての警告を出力
test.rb:2: warning: assigned but unused variable - b
3

$ ruby -W2 test.rb  #全ての警告を出力
test.rb:2: warning: assigned but unused variable - b
3

$ ruby -W1 test.rb  #重要な警告のみ
3

$ ruby -W0 test.rb  #警告を出力しない
3
```

##### コマンドラインオプションの`-r`

**`require`と`load`**

`-r`はスクリプトの実行時に、指定されたライブラリを読み込む

指定されたファイルを絶対パスor相対パスで指定

```ruby
#requireとloadがうまくいかない
#2018/08/11
```

##### コマンドラインオプションの`-l`

指定されたファイルを相対パスで指定した時に、組み込み変数

`$LOAD_PATH`に格納されたパス順に探す

**順番**

1. Rubyのインストールフォルダ

1. Rubyを実行したフォルダ(カレントディレクトリ)

この際に、読み込み順序を拡張する際は`-I`オプションを使用

→このオプションで指定されたフォルダを最優先で検索

例)
rubyインタプリタが参照する主な環境変数

* `RUBYOPT`：デフォルトで指定するコマンドラインオプションを指定

* `RUBYLIB`：デフォルトでライブラリを検索するパスを指定

* `PATH`：Ruby上から実行したコマンドを検索するパスを指定



## APIリファレンス

### `ri`

```ruby
# Ruby技術者認定試験から外れるため、飛ばす
# 2018/08/11
```

### コメントとRDoc

#### コメント

```ruby
# Ruby技術者認定試験から外れるため、飛ばす
# 2018/08/11
```



## 実行順序

上は高く、下は低い

![優先順位](./image/優先順位.jpg)



## 探索順位

* メソッドと変数の探索順位は変数が先です。

```ruby
>> hoge = 0
=> 0
>> def hoge
>>   x = 0
>>   5.times do |i|
?>     x += 1
>>   end
>>   x
>> end
=> :hoge
>> puts hoge
0
=> nil
```


| 版 |  年/月/日 |
|---|----------|
|初版|2018/08/11|
