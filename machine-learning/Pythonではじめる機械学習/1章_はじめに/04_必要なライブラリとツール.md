
04 必要なライブラリとツール
=======================

* `scikit-learn`とその使い方を理解することは重要だが、その他にも便利なライブラリがたくさんある

* `scikit-learn`は、科学技術計算向けPythonライブラリである`NumPy`と`SciPy`の上に構築されている

* `NumPy`と`SciPy`の他にも、`pandas`、`matplotlib`を用いる

* さらに、ブラウザベースのインタラクティブなプログラミング環境である`Jupiter Notebook`も紹介する

## 1. Jupiter Notebook

* `Jupiter Notebook`は、ブラウザ上でコードを実行するためのインタラクティブな環境である

* 探索的なデータ解析をする際には有用なツールであり、データサイエンティストに広く利用されている

* `Jupiter Notebook`は様々なプログラミング言語をサポートしている

* コードやテキストや画像を取り込むことが簡単にできる

## 2. NumPy

* `NumPy`は、Pythonで科学技術計算をする際の基本的なツールの1つである

  * 多次元配列機能や、線形代数やフーリエ変換、擬似乱数生成器などの、高レベルの数学関数が用意されている

* `scikit-learn`では、`NumPy`の配列が基本的なデータ構造となる

  * `scikit-learn`はNumPy配列で入力を受け付ける

  * そのため、使用するデータはNumPy配列に変換しなければならない

* NumPyのコアとなるのは、多次元(n-dimensional)配列の`ndarray`クラスである

  * 配列の全ての要素は同じ型でなければならない


```python
import numpy as np

x = np.array([[1, 2, 3], [4, 5, 6]])
print("x:\n{}".format(x))
```

    x:
    [[1 2 3]
     [4 5 6]]


  $$
   \left[
    \begin{array}{rrr}
      1 & 2 & 3 \\
      4 & 5 & 6
    \end{array}
  \right]
  $$

## 3. SciPy

* `SciPy`は、Pythonで科学技術計算を行うための関数をまとめたもの

  * 高度な線形代数ルーチンや、数学関数の最適化、信号処理、特殊な数学関数、統計分布などの機能を持つ

* `scikit-learn`は、アルゴリズムを実装する際に`SciPy`の関数群を利用している

* 我々にとって最も重要な`SciPy`の要素は、`scipy.sparse`

  * `疎行列`を表現するもので、`scikit-learn`で用いるもう一つのデータ表現となる

  * `疎行列`：成分のほとんどが0となっている2次元配列を格納する際に用いる


```python
import numpy as np
from scipy import sparse

# 対角成分が1でそれ以外が0の、2次元NumPy配列を作る
eye = np.eye(4)
print("NumPy array:\n{}".format(eye))
```

    NumPy array:
    [[1. 0. 0. 0.]
     [0. 1. 0. 0.]
     [0. 0. 1. 0.]
     [0. 0. 0. 1.]]


  $$
  \left[
    \begin{array}{rrr}
      1 & 0 & 0 & 0 \\
      0 & 1 & 0 & 0 \\
      0 & 0 & 1& 0 \\
      0 & 0 & 0 & 1
    \end{array}
  \right]
  $$


```python
# NumPy配列をSciPyのCSR形式の疎行列に変換する
# 非ゼロ要素だけが格納される
sparse_matrix = sparse.csr_matrix(eye)
print("\nSciPy sparse CSR matrix:\n{}".format(sparse_matrix))
```

    
    SciPy sparse CSR matrix:
      (0, 0)	1.0
      (1, 1)	1.0
      (2, 2)	1.0
      (3, 3)	1.0


* 多くの場合、疎なデータを密なデータ構造で作ることはできない(メモリに入らない)

    => 従って、「疎なデータ表現」を直接作る必要がある

* ここでは、上のものと同じ疎行列を`COO形式`で作っている
    
    * `COO形式`：(行, 列, 値) のタプルでリストを作る方法


```python
data = np.ones(4)
row_indices = np.arange(4)
col_indices = np.arange(4)
eye_coo = sparse.coo_matrix((data, (row_indices, col_indices)))
print("COO representation:\n{}".format(eye_coo))
```

    COO representation:
      (0, 0)	1.0
      (1, 1)	1.0
      (2, 2)	1.0
      (3, 3)	1.0


* SciPyの疎行列に関する詳細は、[SciPy Lecture Notes](http://www.scipy-lectures.org/)を参照する

## 4. matplotlib

* `matplotlib`：最も広く使われているPythonの科学技術計算向けのグラフ描画ライブラリ

    * 出版にも使える品質のデータ可視化を実現する関数群を提供する
    
    * 「折れ線グラフ」、「ヒストグラム」、「散布図」などの様々な可視化方法がサポートされている
    
    * Jupiter Notebookでは、`%matplotlib notebook`や`%matplotlib inline`コマンドを用いると、図をブラウザ上に直接表示できる


```python
%matplotlib inline
import matplotlib.pyplot as plt

# -10から10までを100ステップに区切った列を配列として生成
x = np.linspace(-10, 10, 100)

# サイン関数を用いて2つ目の配列を生成
y = np.sin(x)

# plot関数は、一方の配列に対して他方の配列をプロットする
plt.plot(x, y, marker="x")
```




    [<matplotlib.lines.Line2D at 0x111ed44e0>]




![png](./images/output_13_1.png)


## 5. pandas

* `pandas`：データを変換したり、解析したりするためのライブラリ

    * このライブラリは、Rの`DataFrame`を模して作られた、`DataFrame`というデータ構造を中心に構成されている
    
    => `pandas`の`DataFrame`は、「テーブル(表)」のようなもので、エクセルのスプレッドシートに似ている
    
    * テーブルに対してSQLのような問い合わせを行なったり、ジョインしたりすることができる
    
    * NumPyの配列は全ての要素が同じ型でなければならないが、`pandas`の`DataFrame`では列ごとに異なる型でも良い
    
    => 例)整数、日付、浮動小数点数、文字列など
    
    * `pandas`は、様々なファイルフォーマットやデータベースからデータを取り込むことができる
    
        * 例) SQLデータベースや、Excelファイル、CSVファイルなど
        
* 例)`DataFrame`からディクショナリを作る


```python
import pandas as pd
from IPython.core.display import display

# 人を表す簡単なデータセットを作る
data = {'Name': ["John", "Anna", "Peter", "Linda"],
              'Location': ["New York", "Paris", "Berlin", "London"],
               'Age': [24, 13, 53, 33]
             }

data_pandas = pd.DataFrame(data)

# IPython.displayを用いるとDataFrameをJupiter Notebook上で綺麗に表示することができる
display(data_pandas)
```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Location</th>
      <th>Age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>John</td>
      <td>New York</td>
      <td>24</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Anna</td>
      <td>Paris</td>
      <td>13</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Peter</td>
      <td>Berlin</td>
      <td>53</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Linda</td>
      <td>London</td>
      <td>33</td>
    </tr>
  </tbody>
</table>
</div>


* このテーブルに対して様々な方法で問い合わせを行うことができる

* 例)`age`カラムが30を超える全ての行を取り出す


```python
# ageカラムが30を超える全ての行を取り出す
display(data_pandas[data_pandas.Age > 30])
```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Location</th>
      <th>Age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>Peter</td>
      <td>Berlin</td>
      <td>53</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Linda</td>
      <td>London</td>
      <td>33</td>
    </tr>
  </tbody>
</table>
</div>


## 6. mglearn

* `mglearn`：グラフ描写やデータのロードなどの詳細のコードリストで本書が読みにくくならないようにしたもの


> 全てのコードは次のようにインポートしていることを仮定する
>
> ```python
> import numpy as np
> import matplotlib.pyplot as plt
> import pandas as pd
> import mglearn
> from IPython.core.display import display
>```
