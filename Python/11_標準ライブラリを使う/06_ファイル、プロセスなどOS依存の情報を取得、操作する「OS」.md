06 ファイル、プロセスなどOS依存の情報を取得、操作する「OS」
==================================================

* `os`：ファイルやプロセスなど、OSに関連のある処理を行うための関数を集めたモジュール

  * ファイルやディレクトリを作成したり、子プロセスを立ち上げたりといった処理を、プラットフォームにできるだけ依存しない形で実装したい場合にこのモジュールを使う

  * LinuxなどのOSの`システムコール`と同じような処理や、OS依存の処理もこのモジュールに集まっている



## プロセスに関する情報を取得、操作する



### `os.environ`

* 環境変数の内容を保持した、ディクショナリのようなオブジェクト

* キーを使って特定の環境変数を取り出したり、設定を変更したりできる

  * この変数が作られるのは、Pythonが起動した直後

  * 起動直後に`putenv()`関数などを使って、直接環境変数の値を変更しても、この変数には反映されない

* `getenv()`：環境を取得する

  * 引数で指定した環境変数の値を返す

  * 環境変数が存在しない場合は、オプションで指定された値を返す

  ```python
  os.getenv(変数名[, 値])
  ```



## ファイルやディレクトリの操作

* `chdir()`：カレントディレクトリを変更する

  * 現在の作業ディレクトリ(カレントディレクトリ)を引数として渡されたパスに指定する

  ```python
  os.chdir(ディレクトリへのパス)
  ```

* `getcwd()`：カレントディレクトリのパスを返す

  * 現在の作業ディレクトリ(カレントディレクトリ)のパスを返す

  ```python
  os.getcwd()
  ```

* `remove()`：ファイルを削除する

  * 引数に指定されたパスにあるファイルを削除する

  * パスに指定された場所にディレクトリがある場合は、例外(エラー)を発生する

  * ディレクトリを削除したい場合は、`rmdir()`関数を利用する

  ```python
  os.remove(パス)
  ```

* `rename()`：ファイルやディレクトリの名前を変更する

  * ファイルまたはディレクトリの名前を変更する

  * 変更後のパスに指定された場所に、すでにファイルがある場合には、元のファイルを削除する(Windowsでは例外が発生する)

  * ディレクトリがあった場合は例外(エラー)が発生する

  * 途中のパスを含み、再帰的に処理しようとする`renames()`という関数もある

  ```python
  os.rename(変更元のパス, 変更後のパス)
  ```

* `mkdir()`：ディレクトリを作成する

  * 引数として渡されたパスにディレクトリを作成する

  * Linuxなどでは、オプションのモード引数(8進数の整数)を評価して、ディレクトリのパーミッションを指定できる

  * パスの途中に存在しないディレクトリがあった場合は、エラーとなる

  ```python
  os.mkdir(パス[, モード])
  ```

* `makedirs()`：ディレクトリを再帰的に作成する

  * `mkdir()`と同様に、ひっk数として渡されたパスにディレクトリを作成する

  * パスの途中に存在しないディレクトリがあった場合には、それらも作成する

  ```python
  os.makedirs(パス[, モード])
  ```

* `rmdir()`：ディレクトリを削除する

  * 引数として指定されたディレクトリを削除する

  * 指定したディレクトリが空でない場合は、

  ```python
  os.rmdir(パス)
  ```

* `removedir()`：ディレクトリを再帰的に削除する

  * `rmdir()`と同じく、指定されたディレクトリを削除する

  * 指定されたディレクトリの中にさらにディレクトリやファイルがあった場合は、できる限り削除しようとする

  ```python
  os.removedir(パス)
  ```

* `listdir()`：ファイルやディレクトリの一覧を返す

  * 引数として渡されたパスに指定されたディレクトリにある、ファイルやディレクトリ名を取得する

  * ファイル名などを文字列のリストとして返す

  ```python
  os.listdir(パス)
  ```

* `walk()`：ファイルやディレクトリの一覧を再帰的に作成する

  * ループに渡すシーケンスと同じようにfor文に添えて利用する

    * 引数として与えられたパスを起点に、ディレクトリなどの階層を順番に **渡り歩いて** 処理を行う

    * 階層を、より深く移動しながら処理をしていくこともできたり、より浅い階層に向かって処理をすることもできる

  * for文に`os.walk()`を添えて利用すると、以下の3つの値を調べて返す(繰り返し変数で受けるときは、3つの変数をカンマ`,`で並べる)

    1. 処理中の階層のパス(文字列)

    1. 階層に含まれているディレクトリ名一覧(文字列のリスト)

    1. 階層に含まれているファイル名一覧(文字列のリスト)

  * 第2引数にTrueを指定するか、または省略すると、第1引数で指定したディレクトリから下の階層に向かって処理を行う

  * 第2引数にFalseを指定すると、上の階層に向かって処理を行う

  ```python
  os.walk(パス[, 下方向へ処理するかどうか])
  ```

![サンプルの階層](./images/サンプルの階層.png)

  * このような階層があるとき、`walk()`関数を使って次のようなループを組む

  ```python
  for dirpath, dirnames, filenames, in os.walk("/DirA"):
    # ループブロック内の処理...
  ```

  * 1回目のループでは、各ループ変数に以下のような値が代入される

    * `dirpath`：`'/DirA'`

    * `dirnames`：`['DirB', 'DirC']`

    * `filenames`：`['FileA_1', 'FileA_2']`

  * ファイル名やディレクトリ名から、フルパスを得るには`os.path.join()`に`dirpath`とファイル名やディレクトリ名を渡すようにすると良い

  * 繰り返し処理中に、処理対象から除外したい場合は、繰り返し変数を操作する

  * 階層のツリーを渡り歩いて、ファイルやディレクトリの処理をしたい時にこの関数を利用すると便利



## プロセス管理

* `system()`：コマンドを子プロセスとして起動する

  * 子プロセスとして、引数に与えられたコマンド文字列を実行する

  * コマンドの実行が終了するまで待つ

  * 子プロセスとの通信を利用せず、単にコマンドを起動したい時のために利用する

  * プロセスと通信を行う必要がある場合は、`subprocess`モジュールの`Popen`クラスを使う

  ```python
  os.system(コマンド文字列)
  ```

* `startfile()`：関連付けられたアプリケーションでファイルを開く

  * Windowsのみで利用できる関数

  * パスを指定して、ファイルに関連づけられたアプリケーションで開く

  * ファイルをダブルクリックする操作や、Windowsのコマンドプロンプトで`start`コマンドを使った場合と同じ処理

  * アプリケーションが起動するまでを待つ

  ```python
  os.startfile(パス)
  ```



## パスを利用した操作をプラットフォーム互換で行う

* ファイルのパスを文字列で表記する時、問題になることがある

  * 「ディレクトリ」のような階層を区切るために利用する文字がOSによって異なるため、複数OSで問題なく動作するプログラムが書き辛くなってしまう

  * Pythonの「`os.path`」には、OS間のディレクトリの扱いの差を吸収して処理を行えるような関数を集めている

* `exists()`：ファイルやディレクトリが存在するかどうか調べる

  * 引数として渡されたパスにファイルやディレクトリが存在するかどうかを調べる

    * もし存在している場合はTrue(真)を返す

  * 引数がシンボリックリンクを指しているとき、リンクが壊れていてもFalse(偽)を返す

  * `lexists()`を使うと、シンボリックリンクが壊れていてもTrue(真)を返す

  ```python
  os.path.exists(パス)
  ```

* `getsize()`：ファイルサイズを返す

  * 引数として与えられたパスにあるファイルのサイズを「バイト」で返す

  ```python
  os.path.getsize(パス)
  ```

* `isfile()`：ファイルかどうか調べる

  * 引数のパスを調べ、ファイルであった場合にはTrue(真)を返す

  ```python
  os.path.isfile(パス)
  ```

* `isdir()`：ディレクトリかどうか調べる

  * 引数のパスを調べ、ディレクトリであった場合はTrue(真)を返す

  ```python
  os.path.isdir(パス)
  ```

* `join()`：パス名を結合して返す

  * 引数として渡した複数のパスをうまく結合して、パスを生成して文字列として返す

  * 例)パス1に絶対パスを与え、パス2に相対パスを与えると、絶対パスの後ろに相対パスを繋げる

    => パス1にファイル名までを含むパスを与え、パス2にファイル名を与えると、パス1のファイル名を除去してパス2のファイル名を繋げる

  ```python
  os.path.join(パス1[, パス2[, ...]])
  ```

* `split()`：パスを分割して返す

  * 引数として渡したパスを、ディレクトリを表すヘッダ部分と、ファイルを表す部分に分割し、文字列のリストを返す

  * この関数の結果を`join()`関数に渡すと、ほとんどの場合、元のパスが文字列として返ってくる

  * 引数として渡されたパス名を文字列として評価して、最後のファイル名の部分を取り除き、パスのディレクトリ部分を文字列として返す

  ```python
  os.path.dirname(パス)
  ```



| 版 |  年月日   |
|---|----------|
|初版|2019/02/06|
