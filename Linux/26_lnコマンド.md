08 lnコマンド
============

* `ln`コマンド：リンクを張るコマンド

```bash
ln [オプション] <リンク元ファイル> <リンク名>
```



## リンクとは

* Linuxのファイルシステムでは、**ファイルに別名を付ける** ことができる

  => この機能を`リンク`と呼び、別名を付けることを「`リンクを張る`」と表現する

* `リンク`には2種類が存在する

  * `ハードリンク`：使用場面は限定的

  * `シンボリックリンク`：現在は使われることが多い

* Mac OS Xでいう「エイリアス」、Windowsでいう「ショートカット」と似た機能



## ハードリンク

* 例)`/etc/crontab`をコピーした`file1`というファイルに対して、`file2`という名前でハードリンクを作成する

```bash
$ cp /etc/crontab file1
$ ls
file1
$ ln file1 file2
$ ls
file1 file2
$ cat file2               # 別のコマンドからファイル名としてfile2を指定すると、元のfile1にアクセスできるようになる
# (file1の内容が表示される)
```

* 上の`cat`コマンドでは`file2`を指定しているが、元々の`file1`の内容が表示される

  => `file1`を指定しても、`file1`の内容が表示される

  * `ハードリンク`とは、「1つのファイルの実体に複数の名前を付ける機能」

![ハードリンクとは](./images/ハードリンクとは.png)



### ハードリンクの削除

* `rm`コマンドでハードリンクを作成したファイルを削除すると、指定したファイル名だけが取り除かれ、ファイルの実体は残ったままとなる

```bash
$ rm file1
$ ls
file2
$ cat file2
# (file1の内容が表示される)
```

* ハードリンクを持つファイルの実体は、**全てのハードリンクがなくなったときに削除される**

  => ハードリンクは複数のファイル名を付ける機能なので、それらのファイル名全てが無くなったときにファイルの実体も削除される

```bash
$ rm file2
$ ls
$         # 全てのハードリンクが無くなったため、ファイル実体も削除された
```



### シンボリックリンク

* `ハードリンク`は、ディレクトリに対して作成できなかったり、異なるディスク間をまたがることができないなどいくつかの制限がある

* `シンボリックリンク`は、このような制限を受けないため、現在はこちらの方がよく使われる

* `ln`コマンドに`-s`オプションを付けると、シンボリックリンクを作成できる

  * 例)`/etc/crontab`をコピーした`file1`というファイルに対して、`file2`という名前でシンボリックリンクを作成する

    => どのファイルを指しているかが矢印で表示される

  ```bash
  $ cp /etc/crontab file1
  $ ln -s file1 file2
  ```

  ![シンボリックリンクをls_-lで確認](./images/シンボリックリンクをls_-lで確認.png)

  * コマンドでファイル名の代わりにシンボリックリンクを指定すると、そのリンク先のファイルにアクセスできる

  ```bash
  $ cat file2
  # (file1の内容が表示される)
  ```

* `シンボリックリンク`：リンク先のパス名が書かれた小さな特殊ファイル

  * リンク先がファイルの実体であり、本物のファイル

![シンボリックリンクとは](./images/シンボリックリンクとは.png)



### シンボリックリンクの削除

* シンボリックリンクを削除するには、`rm`コマンドを利用する

  => この際、リンク先のファイルには何も影響を与えない

```bash
$ rm file2
$ ls
file1
$
```

* シンボリックリンクを残したまま、リンク先の実体ファイルを削除することもできる

  => この場合には、シンボリックはリンク先がなくなり、「リンクが壊れた」状態となる

```bash
$ ln -s file1 file2
$ ls -l
```

![壊れたシンボリックリンク_1](./images/壊れたシンボリックリンク_1.png)

```bash
$ rm file1
$ ls -l
```

![壊れたシンボリックリンク_2](./images/壊れたシンボリックリンク_2.png)

```bash
$ cat file2
cat: file2: No such file or directory
```



### リンクの利用方法

* 長いパス名を省略する

  * 例)`local/work/code/project/source`という深いディレクトリに、`source`という名前でシンボリックリンクを作る

  ```bash
  $ ln -s local/work/code/project/source source
  $ cd source
  ```

* 複数バージョンのプログラムを共存させる

  * プログラムをインストールする場合に、バージョン番号をディレクトリ名に孵化することで複数バージョンを共存させる場合がある

  * 例)`Ver.1.0.0`と`Ver.1.0.1`をインストールしており、`latest`というシンボリックリンクが`Ver.1.0.1`に向いている

    => `Ver.1.0.0`に戻したい場合は、`latest`のリンク先を`vl.1.0.0`にすることですぐに元に戻すことができる



| 版 |  年/月/日 |
|----|----------|
|初版|2019/02/03|
