05 bashの設定ファイル
===================

* 自分好みのカスタマイズができても、bashを終了すると設定は全て消える

* ログインした時にも同じ設定にするには、bashの設定ファイルを記述する必要がある



## /etc/profile, ~/.bash_profile, ~/.bashrc

* 本章で紹介するカスタマイズを行う際には、基本的に`~/.bashrc`と言うファイルだけを扱えば問題ない



### bashをログインシェルとして起動

* bashをログインシェル(ログインした際に起動されるシェル)として起動した時は、

  1. `/etc/profile`が読み込まれる

  1. `~/.bash_profile`を読み込む

* bashはこれらのファイルに書かれた内容を実行する

  => bashの設定をカスタマイズするには、これらの設定ファイルを、Vimなどのエディタを使って修正する

* `/etc/profile`：システム全体で使用する設定ファイル

  * 全てのユーザに共通の設定を行いたい場合にはこのファイルに記述する

    => 通常はディストリビューションごとに適切な設定があらかじめ書かれているので、修正する必要はない

* `~/.bash_profile`：各ユーザ個別の設定ファイル

  * 多くのディストリビューションでは、`~/.bash_profile`から`~/.bashrc`を読み込む

  * 設定の内容は、「もし`~/.bashrc`ファイルが存在すれば、その内容を現在のシェルに反映する」

  ```bash
  if [ -f ~/.bashrc ]; then
    source ~/.bashrc
  fi
  ```

  * そのため、bashはログインシェルとして起動されると3つの設定ファイルを順に読み込む

  ![ログインシェル](./images/ログインシェル.png)



### bashを非ログインシェルとして起動

* コマンドライン場で`bash`と入力してコマンドとしてbashを起動した場合

* `~/.bashrc`が設定ファイルとして読み込まれる

![非ログインシェル](./images/非ログインシェル.png)



### 設定はどのファイルに書くべきか

* `~/.bash_profile`と`~/.bashrc`は、どちらもユーザ個別のbashの設定ファイル

  => どのように使い分ければ良いか

* `~/.bash_profile`はログインした時にだけ読み込まれる

  => ログイン時に一度だけ設定すれば良い項目を書き込む

* `~/.bashrc`はbashを起動するたびに読み込まれる

  => bashを起動するたびに毎回設定する必要がある項目を書き込む

  * 実際に多くの設定はbashを起動するたび毎回設定する必要がある項目は`~/.bashrc`に書き込む



## 設定ファイルの変更時の注意

* 最初の状態の`~/.bashrc`ファイルはバックアップを取っておき、すぐ元に戻せるようにする

  => 何かミスをして`.bashrc`を消してしまっても、`.bashrc.org`からコピーすることで元に戻すことができる

```bash
$ cp .bashrc .bashrc.org
```

* bashの設定を色々と試していると、誤った設定記述によって、簡単に復旧できないような状態になってしまう

  例)`/.bashrc`に`exit`と記述すると、bash起動時にこのコマンドが実行され、ログインした直後にログアウトしてしまう

  => 設定を行うシェルとは別にもう1つシェルを起動しておく

![設定ファイル変更作業](./images/設定ファイル変更作業.png)

* 上の図では、設定変更を行う際に別のターミナルエミュレータを起動しておく

  * `ssh`でログインしている場合は、設定変更用とは別にもう一つ別に`ssh`にログインしておき、そちらはログアウトしないようにする

* こうすれば、間違えてログインできなくなった場合でも、別に起動しておいたシェルから復旧作業ができる

  1. Vimで誤った記述を削除する

  1. 元のバックアップファイル`.bashrc.org`で現在の`.bashrc`を上書きする



## 設定ファイルの読み込み

* `.bashrc`ファイルは基本的に用意されているため、Vimで既存ファイルを開いて最後の行に追記する

```bash
PS1='[\u@\h] \W \t \$ '
```

* 一旦ログアウトして再びログインすると、プロンプトが以下のように変わる

  * このようにすることで、毎回ログイン後にコマンドを打たずにも設定を反映させることができる

```bash
[xxx@localhost] ~ 19:04:44 $
```

* `~/.bashrc`ファイルを修正した後に一旦ログインし直すのが面倒な場合は、次のように`source`コマンドを利用すると即座に反映できる

```bash
$ source ~/.bashrc
```

* `source`コマンド：ファイルの内容を読み込んで実行する

  * sourceで指定したファイルに書いてある内容を、直接コマンドラインで実行することと同じ



## コメント

* bashでは、`#`から行の終わりまではコメントとして無視される

```bash
# この行はコメントです
# alias ll='ls -alF'

PS1='[\u@\h] \W \t \$ ' # 行の途中からコメントを書くこともできる
```



## bashのカスタマイズ例

* `~/.bash_profile`

```bash
export PATH="$PATH:$HOME/bin"

if [ -f ~/.bashrc ]; then
  source ~/.bashrc
fi
```

* `~/.bashrc`

```bash
LANG=ja_JP.UTF-8
PS1='[\u@\h] \w\$ '
export LESS='--no-init'

set -o ignoreeof

# コマンド履歴設定
shopt -s histappend
HISTSIZE=1000000
HISTFILESIZE=1000000

# エイリアスの設定
alias ls='ls -F'
alias la='ls -a'
alias ll='ls -l'
alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'
alias mkdir='mkdir -p'
```



| 版 |  年/月/日 |
|----|----------|
|初版|2019/02/14|
