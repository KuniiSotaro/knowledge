02 よく起こるエラーや例外と対策
==========================

* Pythonではプログラム上で起こる全てのエラーが例外として扱われる

* 例外が発生すると、入れ子になって呼び出されている関数やメソッドを上へと辿っていく

  * その過程で例外を受け取るexcept文などが見つからないと、プログラムの実行を停止する

* 例外が発生し、プログラムの実行が停止すると、Pythonはトレースバックと呼ばれるエラーを表示する

  * トレースバックには、エラーが起こった関数やメソッドを呼び出しているコードの情報を含め、様々な情報が表示されている

  * トレースバックが表示されている一番下の行を見ると、エラーの内容を把握しやすい

  * トレースバックにはエラーが発生したプログラムのファイル名や行数、例外の種類などが記載されている

* 例外は、種類や性質によって何種類かのカテゴリに分かれている

  * `例外クラス`：例外の実体

  * `Exception`：一般的な例外の親クラス

    => この下に実際に例外の発生時に利用される例外クラスが細かく分けて定義されている

* Pythonは、プログラムで扱う変数や関数、モジュールまでもがオブジェクトとして定義されている

  * オブジェクト自体も、アトリビュートという仕組みを使ってとてもシンプルな構造になっている

  * そのため、同じタイプのエラー(例外)が、複数の原因で発生することがある

    => エラーの原因がわかりにくい



## プログラムを読み込むときに起こるエラー(SyntaxError)

* `SyntaxError`：文法エラー

  * プログラムの実行前に起こる例外をまとめたクラスとして定義されている

  * import文でモジュールを読み込んだ時にもこの例外が起こる

  * 大抵は、クオーテーションや括弧の対応が取れていない場合、インデントが正しく行われていない場合

  * `IndentationError`：インデントが正しく行われていない場合に発生する

* この例外が発生すると、Pythonはプログラムを実行できない



## プログラム実行中に起こるエラー(Exception)

* プログラム実行中に起こるエラーは、`Exception`という例外にまとめて定義されている

* except文で`Exception`クラスを定義すると、`SyntaxError`なども含む全ての例外を受けてしまう

* `Exception`を受け取るようにすると、プログラムを実行中に起こるエラーだけを捕まえることができる

* `Exception`は、さらに細かい例外クラスに分類されている



### NameError

* 未定義の変数などを参照しようとした時に発生する例外

* 未定義の関数を呼び出そうとした時や、インポートしていないモジュールを使おうとした時も、発生する

* 大抵はコード上のタイプミスが原因で生じる

* 複合演算子(`+=`など)を使って未定義の変数に代入を行おうとした時にも発生する



### AttributeError

* オブジェクトに定義されていないアトリビュートを参照しようとした時に起こる例外

* 未定義のメソッドを呼び出そうとした時にも発生する

* 組み込み型のオブジェクトのように、アトリビュートの追加が許されていないオブジェクトにアトリビュートを代入しようとして失敗した時にも発生する

* タイプミスによって起こりやすい

* 関数に引数を渡す場合などに、コードで期待している型と異なる型のオブジェクトを渡した時も発生する

* オブジェクトに存在しないメソッドを呼び出すなど、オブジェクトの扱いが正しくない場合にも発生する

  => 関数を呼び出している側のコードを確認し、修正するなどして対処



### TypeError

* 処理の過程でふさわしくない型のオブジェクトが使われた時に発生する例外

* 文字列と数値を足すなど、演算子を使った演算をする場合に発生する

* リストの要素をインデックスで参照するとき、整数以外のオブジェクトをインデックスとして使った場合にも発生する

* 組み込み型のメソッドや組み込み型の関数の引数として、想定されていない型のオブジェクトが渡された場合にもこの例外が発生する

  => プログラムの間違いがほとんど

* 例外が発生すると表示されるトレースバックには、大抵例外のクラス名に添えてより詳しい原因が以下のような英文で表示される

```python
# int型とstr(文字列)型を足すことはできない
unsupported operand type(s) for: 'int' and `str`
```

```python
# str(文字列)型とint型を連結することはできない
cannot concatenate 'str' and 'int' objects
```

```python
# リストのインデックスは必ず整数でなければならない
TypeError: list indices must be integers
```

```python
# シーケンス型でないオブジェクトを使ってイテレーションを実行しようとした場合(シーケンス型を要求する場所にそれ以外のオブジェクトを記述した)
iteration over non-sequence
```



### IndexError

* リストのようなシーケンスをインデックスで参照しようとするとき、シーケンスの要素数を超える数を指定した場合に発生する例外

* 主にプログラムの間違いが原因で発生する

  => インデックスがリストの要素数に収まるようにプログラムを修正して対処する



### KeyError

* ディクショナリオブジェクトの要素をキーで参照する時、存在しないキーを指定するとこの例外が発生する

* ディクショナリ風の表記で要素にアクセスできるようになっているオブジェクトでも、発生する

* set型で存在しない要素にアクセスしようとする時にも、発生する

* 主にプログラムの間違いが原因で発生する

  => 事前にキーを調べてからディクショナリのキーを参照するなどして、プログラムを修正して対処する



### ImportError

* import文でモジュール定義を見つけられなかった場合に発生する

* from文で指定した関数や変数がモジュールに見つからなかった時にも、この例外が発生する



### UnicodeDecodeError、UnicoeEncodeError

* 文字列型やバイト型のデコード、エンコード中にエラーが起こった場合に発生する例外



### ZeroDivisionError

* 数値を0で割ろうとするときに発生するエラー



| 版 |  年月日   |
|---|----------|
|初版|2019/02/03|
