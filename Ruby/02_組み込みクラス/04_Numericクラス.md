04 数値型クラス
==============

## 目次

* [この章で扱うクラスについて](#0この章で扱うクラスについて)

* [Numericクラス](#1Numericクラス)

* [Floatクラス](#2Floatクラス)

* [Integerクラス](#3Integerクラス)

* [FixnumクラスとBignumクラス](#4FixnumクラスとBignumクラス)

* [Rationalクラス](#5Rationalクラス)

* [Complexクラス](#6Complexクラス)



## 0.この章で扱うクラスについて

* `Numeric`クラス：数値を表すクラス。他のクラスはこのクラスを継承

  * `Integer`クラス：整数を表すクラス

  * `Float`クラス：浮動小数点数を表すクラス

  * `Complex`クラス：複素数を扱うクラス

  * `Rational`クラス：有理数を扱うクラス



## 1.Numericクラス

* 小数点の切り捨て、切り上げには以下のメソッドを使用

  * `ceil`：それ自身と同じかそれ自身より大きな整数のうち、最小のものを返す

  * `floor`：それ自身より小さな整数のうち、最大のものを返す

  * `round`：もっとも近い整数を返す

  * `truncate`：それ自身と`0`の間にある整数で、もっとも近いものを返す

```ruby
>> 1.9.ceil       # 1.9より大きな整数・・・2
=> 2
>> 1.9.floor      # 1.9より小さな整数・・・1
=> 1
>> 1.9.round      # 一番近い整数・・・2
=> 2
>> 1.9.truncate   # 1.9と0の間で一番近い整数・・・1
=> 1
>> -1.1.ceil      # -1.1より大きな整数・・・-1
=> -1
>> -1.1.floor     # -1.1より小さな整数・・・-2
=> -2
>> -1.1.round     # -1.1に一番近い整数・・・-1
=> -1
>> -1.1.truncate  # -1.1と0の間で一番近い整数・・・-1
=> -1
```



### 数値の絶対値

* `abs`メソッド：数値の絶対値を返す

```ruby
>> -3.abs
=> 3
```



### 数値を使った繰り返し

* `step`メソッド：1から100までの繰り返しなどを返す

* `downto`メソッド：30から15までの繰り返しなどを返す

```ruby
>> 1.step(10,2){|n| puts n}   # 1から10までの奇数を表示
1
3
5
7
9
=> 1
```



## 2.Floatクラス

* 浮動小数点数として保存される

  > 計算過程で誤差が発生することがある

* 小数で処理できない処理(シフト演算、ビット演算など)は実装されていない

```ruby
>> 1.23 & 2
NoMethodError: undefined method ｀&｀ for 1.23:Float
```



## 3.Integerクラス

* `**`メソッド：整数のべき乗を求める

* `/`メソッド：整数の除算を求める

  * 整数同士の除算では、整数が結果として返る

```ruby
# べき乗
>> 2.**(4)
=> 16
>> 2 ** 4
=> 16

# 除算
>> 10 / 3
=> 3
>> 10 / 3.0
=> 3.3333333333333335
```



### 整数に対応する文字を求める

* `chr`メソッド：アスキーコードに対応する文字を求める

  * 対応する文字がない場合は、`RangeError`になる

```ruby
>> 65.chr
=> "A"
>> -1.chr
RangeError: -1 out of char range
```

* 引数で与えられた`encoding`において、`self`を文字コードと見なし、それに対応する一文字からなる文字列を返す。

* 指定されたエンコーディングで`self`を正しく解釈できない場合はエラーが発生する。



### 次の整数、前の整数を求める

* `next`メソッド：(整数に対して)次の整数を返す

  * `succ`メソッドでもある

  * `String`クラスにもある

* `pred`メソッド：自身の数から-1した整数を返す

```ruby
>> 10.next
=> 11
>> 10.succ
=> 11
>> 10.pred
=> 9
```



### 整数を使った繰り返し

* `times`メソッド：その整数の数だけ、与えられたブロックを実行

* `upto`メソッド：ある整数からある整数まで、与えられたブロックを実行

* `downto`メソッド：ある整数からある整数まで、与えられたブロックを実行

```ruby
>> sum = 0
=> 0
>> 10.times {|i| sum += i}
=> 10
>> puts sum                    # 1+2+3+4+5+6+7+8+9=45
45
=> nil
```



## 4.FixnumクラスとBignumクラス

* `Fixnum`クラス：123のような数値リテラルのクラス

* `Bignum`クラス：数値が大きい数値リテラルのクラス

* どちらも基本的に同じなので、`Fixnum`クラスをここでは扱う

***

### 数値の剰余

* `%`メソッド：剰余に使われる。`modulo`メソッドでも同様。

```ruby
>> 10.modulo(3)
=> 1
>> 10 % 3
=> 1
```



### ビット演算

* `|`：論理和
* `&`：論理積
* `^`：排他的論理和
* `~`：否定
* `<<`：左シフト演算
* `>>`：右シフト演算

例)10(0b1010)と3(0b0011)のビット演算

```ruby
>> 10 | 3
=> 11            # 0b1011
>> 10 & 3
=> 2             # 0b0010
>> 10 ^ 3
=> 9             # 0b1001
>> ~ 10
=> -11           # 0b..10101
>> 10 << 1
=> 20            # 0b10110
>> 10 >> 1
=> 5             # 0b0101
```


### 数値の小数化

* `to_f`メソッド：`Float`クラスに変換するメソッド

```ruby
>> 10.to_f
=> 10.0
```



### 小数を使った繰り返し

* `step`メソッド：小数で繰り返しを行うメソッド

```ruby
>> 1.5.step(21.5, 2.5){|f| puts f}
1.5
4.0
6.5
9.0
11.5
14.0
16.5
19.0
21.5
=> 1.5
```



## 5.Rationalクラス

有理数を扱う`Numeric`クラスのサブクラス

* `Rational`クラスによる有理数のインスタンスを作成するには、`Rational(a,b=1)`のように表す(`a`：分子、`b`：分母)

* `denominator`メソッド：有理数の分母を求める

* `numerator`メソッド：有理数の分子を求める

* `Numeric`クラスでも、これらのメソッドは使用可能

  * 返り値は、自身を`Rational`に変換した場合に対応する値

```ruby
>> a = Rational(1,2)   # Rationalクラスによるインスタンスの作成(1/2)
=> (1/2)
>> a.denominator       # 1/2の、分母(2)
=> 2
>> a.numerator         # 1/2の、分子(1)
=> 1
>> 0.25.denominator    # 0.25は1/4。これの分母(4)
=> 4
>> 0.25.numerator      # 0.25は1/4。これの分母(1)
=> 1
```



### `divmod`メソッド

* 引数`other`で除算した結果と、その剰余を配列で返す

* `abs`メソッド：絶対値を返す

```ruby
>> Rational(1,2).divmod Rational(1,3)
=> [1, (1/6)]               # 1 * (1/3) + (1/6) = 1/2
>> Rational(-4,13).abs
=> (4/13)
```



### 整数を丸める結果を返すメソッド

* `floor`メソッド：小さい方の整数に丸める

* `ceil`メソッド：大きい方の整数に丸める

* `truncate`メソッド：0に近い方の整数に丸める

* `round`メソッド：絶対値を四捨五入する

```ruby
# 定義
>> a = Rational(1,3)
=> (1/3)
>> b = Rational(2,3)
=> (2/3)
>> c = Rational(-1,3)
=> (-1/3)
>> d = Rational(-2,3)
=> (-2/3)

# floorメソッド
>> a.floor
=> 0
>> b.floor
=> 0
>> c.floor
=> -1
>> d.floor
=> -1

# ceilメソッド
>> a.ceil
=> 1
>> b.ceil
=> 1
>> c.ceil
=> 0
>> d.ceil
=> 0

# truncateメソッド
>> a.truncate
=> 0
>> b.truncate
=> 0
>> c.truncate
=> 0
>> d.truncate
=> 0

# roundメソッド
>> a.round
=> 0
>> b.round
=> 1
>> c.round
=> 0
>> d.round
=> -1
```



### `Rational`クラスと他の`Numeric`クラスとの四則演算

* `Rational`クラスは、四則演算の中で演算対象のクラスを判別して、返す結果のクラスを決定

* 演算の対象が`Rational`または`Integer`の場合、`Rational`が演算結果

* 演算の対象が`Float`の場合、`Float`が演算結果

```ruby
>> Rational(1,2) + Rational(1,3)
=> (5/6)
>> Rational(1,2) + 1
=> (3/2)
>> Rational(1,2) + 0.25
=> 0.75
```



## 6.Complexクラス

* 複素数を扱う`Numeric`クラスのサブクラス

* 複素数のインスタンスを作成するには、`Complex(a,b)`と記述(`a`：実数、`b`：虚数)

* 複素数リテラルでは、虚部の数値の値の後に`i`をつけて表すことができる

* 複素数の実部と虚部は、以下のように表される

  * `real`メソッド：     実部

  * `imaginary`メソッド：虚部

* `Numeric`クラスでもこれらのメソッドを使用できるが、以下のように返す

  * 実部：`self`

  * 虚部：`0`

```ruby
>> a = (1+2i)
=> (1+2i)
>> a.real
=> 1
>> a.imaginary
=> 2
>> 3.real
=> 3
>> 3.imaginary
=> 0
```



### 複素数の極座標表現

* (x+iy)=r(cosθ+sinθ)

* `abs`メソッド：`r`(絶対値)を返す

* `arg`メソッド：`θ`(偏角)を返す

* `polar`メソッド：絶対値と偏角を、配列で返す

```ruby
>> Complex(1,3).abs     # 絶対値
=> 3.1622776601683795
>> Complex(1,3).arg     # 偏角
=> 1.2490457723982544
>> Complex(1,3).polar   # 絶対値&偏角
=> [3.1622776601683795, 1.2490457723982544]
```



### `Complex`クラスと他の`Numeric`クラスの四則演算

* `Numeric`クラスのサブクラスも`real`メソッド、`imaginary`メソッドが使用可能

  * `Bignum`、`Fixnum`、`Float`などのインスタンスを跨いでも四則演算が可能

* 四則演算の結果は、`Complex`クラスのインスタンスで返る

```ruby
>> Complex(1,1) + 0.5
=> (1.5+1i)
```



| 版     | 年/月/日   |
| ------ | ---------- |
| 第二版 | 2019/05/11 |
