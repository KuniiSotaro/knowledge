13 Timeクラス
============

## 目次

* [Timeクラスとは](#0Timeクラスとは)

* [Timeオブジェクトの生成](#1Timeオブジェクトの生成)

* [Timeオブジェクトの属性を取得する](#2Timeオブジェクトの属性を取得する)

* [タイムゾーンを変更する](#3タイムゾーンを変更する)

* [Timeオブジェクトの演算](#4Timeオブジェクトの演算)

* [Timeオブジェクトの変換](#5Timeオブジェクトの変換)

* [フォーマットに指定できる文字](#6フォーマットに指定できる文字)



## 0.Timeクラスとは

* 時刻を表すクラス

* 時刻は、世界標準時の1970年1月1日午前0時(起算時)からの経過秒数で保持される

* タイムゾーンとして、 **UTC** か **地方時刻(ローカルタイム)** を指定することができる



## 1.Timeオブジェクトの生成

* `Time.new`、`Time.now`：現在時刻の`Time`オブジェクトを生成して返す

  * タイムゾーンはローカルタイム(日本なら、`+0900`)

* `Time.at`：引数で指定した起算時からの秒数に対応する`Time`オブジェクトを生成して返す

  * さらに精度が必要な場合には、2番目の引数にマイクロ秒を指定

* `Time.mktime`、`Time.local`：与えられた引数に対応する`Time`オブジェクトを生成して返す

  * 引数が7個までの場合、先頭から`年`、`月`、`日`、`時`、`分`、`秒`、`マイクロ秒`を指定できる

  * 年のみ省略できない。他の引数を省略した場合は、`1`、`1`、`0`、`0`、`0`、`0`が指定されたとみなす

  * 月に関しては、`"Jan"`や`"Feb"`などの英語の月名の省略形も指定できる

  * 引数が10個の場合は、先頭から`秒`、`分`、`時`、`日`、`月`、`年`、`曜日に対応する数値`、`年日`、`夏時間かどうかの真理値`、`タイムゾーン`を指定できる

  * ただし、`曜日に対応する数値`、`年日`、`夏時間かどうかの真理値`、`タイムゾーン`に関しては無視される

* `Time.gm`、`Time.utc`：引数の数やその順序は`Time.mktime`と同じだが、生成される`Time`オブジェクトのタイムゾーンが **UTC** になる

```ruby
# Time.nowメソッド
>> Time.now
=> 2018-09-15 12:08:25 +0900

# Time.atメソッド
>> Time.at(1234567890)
=> 2009-02-14 08:31:30 +0900
>> Time.at(1234567890, 1234567890)  # マイクロ秒指定
=> 2009-02-14 08:52:04 +0900

# Time.mktimeメソッド(引数7個)
>> Time.mktime(2017)          # 年のみ指定
=> 2017-01-01 00:00:00 +0900
>> Time.mktime(2017, 7, 7)    # 年、月、日のみ指定
=> 2017-07-07 00:00:00 +0900

# Time.mktimeメソッド(引数10個)
>> Time.mktime(0, 0, 0, 7, 7, 2017, 4, 188, false, "JST")
=> 2017-07-07 00:00:00 +0900

# Time.gmメソッド
>> Time.gm(2017)
=> 2017-01-01 00:00:00 UTC
>> Time.gm(2017, 7, 7)
=> 2017-07-07 00:00:00 UTC
```



## 2.Timeオブジェクトの属性を取得する

* `year`：年を取得

* `mon`、`month`：月を取得

* `day`、`mday`：日を取得

* `hour`：時を取得

* `min`：分を取得

* `sec`：秒を取得

* `usec`、`tv_usec`：マイクロ秒を取得

```ruby
>> t = Time.mktime(2017, 1, 2, 3, 4, 5, 6)
=> 2017-01-02 03:04:05 +0900
>> t.year     # 年を取得
=> 2017
>> t.mday     # 日を取得
=> 2
>> t.sec      # 秒を取得
=> 5
```

* `wday`：曜日に対応する数値を返す。日曜(0)〜土曜(6)が対応

* `yday`：1月1日からの日数を返す

```ruby
>> t = Time.mktime(2017, 1, 2, 3, 4, 5, 6)
=> 2017-01-02 03:04:05 +0900
>> t.wday      # 月曜日
=> 1
>> t.yday      # 1月1日から2日目
=> 2
```

* `isdst`、`dst?`：夏時間かどうかを返す

* `gmt?`、`utc?`：タイムゾーンが **UTC** かどうかを返す

```ruby
>> t = Time.mktime(2017, 1, 2, 3, 4, 5, 6)
=> 2017-01-02 03:04:05 +0900
>> t.dst?
=> false
>> t.gmt?
=> false
```

* `gmtoff`、`gmt_offset`：UTC時刻との差を秒単位の数値として返す

```ruby
>> t = Time.mktime(2017, 1, 2, 3, 4, 5, 6)
=> 2017-01-02 03:04:05 +0900
>> t.gmtoff
=> 32400
>> t.gmtoff / 3600  # 時に変更
=> 9
```



## 3.タイムゾーンを変更する

* `localtime`：タイムゾーンをローカルタイムに変更

* `gmtime`、`utc`：タイムゾーンをUTCに変更

```ruby
>> t = Time.mktime(2017, 1, 2, 3, 4, 5, 6)
=> 2017-01-02 03:04:05 +0900
>> t.localtime
=> 2017-01-02 03:04:05 +0900
>> t.gmtime
=> 2017-01-01 18:04:05 UTC
```

* `getlocal`：タイムゾーンをローカルタイムに変更した新しい`Time`オブジェクトを返す

* `getgm`、`getutc`：タイムゾーンをUTCに変更した新しい`Time`オブジェクトを返す

```ruby
>> t = Time.mktime(2017, 1, 2, 3, 4, 5, 6)
=> 2017-01-02 03:04:05 +0900
>> t.object_id
=> 70329225673020
>> t1 = t.getlocal
=> 2017-01-02 03:04:05 +0900
>> t1.object_id
=> 70329225651440
```



## 4.Timeオブジェクトの演算

* `+`：指定した秒数後の`Time`オブジェクトを返す

* `-`：指定した秒数前の`Time`オブジェクトを返す

```ruby
>> t = Time.mktime(2017, 1, 2, 3, 4, 5, 6)
=> 2017-01-02 03:04:05 +0900
>> t + 60 * 60 * 3
=> 2017-01-02 06:04:05 +0900
>> t - 60 * 60 * 3
=> 2017-01-02 00:04:05 +0900

# Timeオブジェクト同士の差
>> t1 = Time.mktime(2011, 1, 2, 3, 4, 5, 6)
=> 2011-01-02 03:04:05 +0900
>> t2 = Time.mktime(2011, 2, 3, 4, 5, 6, 7)
=> 2011-02-03 04:05:06 +0900
>> t2 - t1
=> 2768461.000001
```



### 例題

```ruby
>> t = Time.now + (60*60*24)
=> 2018-09-29 00:07:02 +0900

# 実行時の日時から24時間後(86400秒後)の日時が表示される
>> p t
2018-09-29 00:07:02 +0900
=> 2018-09-29 00:07:02 +0900
```



## 5.Timeオブジェクトの変換

* `to_i`、`tv_sec`：起算時からの秒数を整数で返す

* `to_f`：起算時からの秒数を浮動小数点数で返す

```ruby
>> t = Time.mktime(2017, 1, 2, 3, 4, 5, 6)
=> 2017-01-02 03:04:05 +0900
>> t.to_i
=> 1483293845
>> t.to_f
=> 1483293845.000006
```

* `to_a`：先頭から、秒、分、時、日、月、年、曜日に対応する数値、年日、夏時間かどうかの真理値、タイムゾーン順の配列を返す

```ruby
>> t = Time.mktime(2017, 1, 2, 3, 4, 5, 6)
=> 2017-01-02 03:04:05 +0900
>> t.to_a
=> [5, 4, 3, 2, 1, 2017, 1, 2, false, "JST"]
```

* `to_s`：UNIXコマンドのdateコマンドのような形式の文字列を返す

```ruby
>> t = Time.mktime(2017, 1, 2, 3, 4, 5, 6)
=> 2017-01-02 03:04:05 +0900
>> t.to_s
=> "2017-01-02 03:04:05 +0900"
```

* `strftime`：指定したフォーマットに従って文字列に変換した結果を返す

```ruby
>> t = Time.mktime(2017, 1, 2, 3, 4, 5, 6)
=> 2017-01-02 03:04:05 +0900
>> t.strftime("%Y年%m月%d日 %H時%M分%S秒")
=> "2017年01月02日 03時04分05秒"
```



## 6.フォーマットに指定できる文字

| フォーマット | 内容                                             |
| ------------ | ------------------------------------------------ |
| `%A`         | 曜日の英語名(Sunday, Monday, ...)                |
| `%a`         | 曜日の英語での省略形(Sun, Mon, ...)              |
| `%B`         | 月の英語名(January, February, ...)               |
| `%b`         | 月の英語の省略形(Jan, Feb, ...)                  |
| `%c`         | 日付と時刻                                       |
| `%D`         | 日付(%m/%d/%y)                                   |
| `%d`         | 日(01-31)                                        |
| `%F`         | %Y-%m-%d                                         |
| `%H`         | 24時間制の時(00-23)                              |
| `%I`         | 12時間制の時(01-12)                              |
| `%j`         | 年中の通算日(001-366)                            |
| `%M`         | 分(00-59)                                        |
| `%m`         | 月(01-12)                                        |
| `%p`         | 午前または午後(AM、PM)                           |
| `%S`         | 秒(00-60)<br>(60はうるう秒)                      |
| `%U`         | 週を表す数<br>最初の日曜日が第1週の始まり(00-53) |
| `%W`         | 週を表す数<br>最初の月曜日が第1週の始まり(00-53) |
| `%w`         | 曜日を表す数<br>日曜日が0(0-6)                   |
| `%x`         | 日付(%m/%d/%y)                                   |
| `%Y`         | 西暦を表す数(9999)                               |
| `%y`         | 西暦の下2桁(00-99)                               |
| `%Z`         | タイムゾーン                                     |
| `%%`         | %                                                |



| 版     | 年/月/日   |
| ------ | ---------- |
| 第二版 | 2019/05/11 | 
