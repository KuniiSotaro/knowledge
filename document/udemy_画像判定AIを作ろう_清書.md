【画像判定AI自作にチャレンジ！】TensorFlow・Keras・Python・Flaskで作る機械学習アプリ開発入門
==================================================================================

こんにちは！当社でインターンを初めて8ヶ月の國井です。

前回はRuby技術者認定試験のコラムについて書きましたが、今回はAIに挑戦してみました。



## コースを進めて

このコースでは、以下の8つのセクションによって構成されていました。

1. はじめに

1. 環境構築(Python、Anaconda、TensorFlow CPU版のインストール)

1. 【オプション】TensorFlow GPU版のセットアップ(NVIDIA製GPU搭載マシン使用者のみ。非搭載の方はスキップしてください)

1. 画像分類AI自作にチャレンジ

1. データの工夫による精度向上にチャレンジしてみよう

1. 推定プログラムを作成しよう

1. FlaskでWebアプリ化しよう!

1. ボーナスセクション

これらの章を実際に行っての感想を述べていきます



### 環境構築

この教材では`Anaconda`上で実行するとのことでした！

バージョンとしては`Anaconda5.0.0`、`Python3.6`でインストールしているので、

以下のリンクのアーカイブから、教材に適応する`Anaconda`をインストールしました。

https://repo.continuum.io/archive/

次に、`Anaconda`上で`TensorFlow`という機械学習用のライブラリをインストールします

このインストールが成功したら、成功です！

その後、`TensorFlow`のGPU版のインストールでした。

しかし、NVIDIA製のマシンでなればインストールができないとのことなので、私はスキップしました。



### 画像分類

作成するアプリケーションでは、「サル」、「イノシシ」、「カラス」のそれぞれ100枚の画像を、

機械学習して、モデル(分類器)を用いて、カメラなどで作成した写真を通して評価する、というものです

アプリの開発フローとしては、

1. データの収集・生成

1. データの前処理

1. モデルを定義

1. トレーニング(教師あり学習)

1. テスト

1. 評価

という流れです。


データの収集では、flickrと言う写真がたくさん集まっているサイトから、

`urllib`ライブラリを使って写真をダウンロードします

> 「クローリング」という

これに関しては、当社でもAPIを頻繁に使用しているので、イメージをすることができました。



### データの生成

pillowと呼ばれるpythonの画像を扱うライブラリを使用して、

* PIL：Image

* os：glob(ファイルの一覧)

* numpy：配列を扱う

* scikit-leran：クロスバリデーション(データを分離して学習と評価を行う)



### トレーニングしたデータをテスト・実行

* `Keras`：

  * ニューラルネットワークを使用する際に使用(sequential)

  * 二次元のデータ

  * 活性化関数

  * ドロップアウト

  * データを一次元に変更

  * dense：全結合層

   => 最後の出力層は3層

  * np_utils

* numpy

* `np.load`：ファイルからデータを配列に読み込む

  => 最大値で割ることで、float型に変更されて計算しやすくなる

* `one-hot-bector`：正解値は1、他はゼロ

  => `[0,1,2]`を`[1,0,0]`、`[0,1,0]`、`[0,0,1]`に変更する

* このURLにあるコードを参考にした

https://github.com/keras-team/keras/blob/master/examples/cifar10_cnn.py

> `def model_train()`

* `Conv2D`を使用

* トレーニング時の最適なアルゴリズム

* 損失関数：正解と推定値の誤差

* モデルの結果を、`model.save`で、`.h5`という拡張子で保存する



### 学習とテストを実行する

* `h5`ファイルは、pipでインストールすることで保存できる

* `GPU`よりも`CPU`の方が学習が遅い



## 推定プログラムを作成する

* コマンドラインから、画像ファイルを与えて推定するプログラムを作る

* 既存モデルをロードする(h5ファイル)

* 推定を行う(`predict.py` 引数に`画像ファイル名`)

1. パッケージのインポート

1. 変数の初期化

1. モデル定義、パラメータのロード

1. 推定処理の実行

* `load_model`を用いて、変数modelを返す

* 一番値の大きい配列の添字を返す(推定)：一番確率が高いものを返す



### Flaskでアプリ化しよう

* Flaskのインストールは、pipで行う

* `werkzeug.utils`：ファイルをチェックする関数(`secure_filename`)、Flaskのモジュール
