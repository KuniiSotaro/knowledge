04 標準正規分布とは異なる普通の分布を解析する 正規分布
==============================================

## 1. 一般正規分布

* 一般正規分布:「$\mu=0$」、「$\sigma=1$」の標準正規分布とは異なる平均値、標準偏差を持つ分布

* 変数変換 :標準偏差($\sigma=1$)に対する割合を求める

    > データから平均を引くことで、正規分布の平均は$0$となる。
    >
    > $\frac{1}{\sigma}$ より、$\sigma$ を標準正規分布の $\sigma=1$ に対する値を求める

  * $z$:標準正規分布の $\sigma$ の位置

  * $X$:正規分布のデータ

$$
\begin{eqnarray}
z = \frac{X-\mu}{\sigma}
\end{eqnarray}
$$

  > 正規分布のデータ $X$ を、標準正規分布の $\sigma$ に換算した値がわかる

* 確率密度関数:正規分布の $x$ を求める関数 $f(x)$

$$
\begin{eqnarray}
f(x) = \frac{1}{\sigma \sqrt{2 \pi}}e^{-\frac{1}{2}\bigr( \frac{x-\mu}{\sigma} \bigl)^2}
\end{eqnarray}
$$

  1. 「グラフの山の頂点は0、正の領域と負の領域で対称」として、平均値を平行移動

  2. 「グラフの山の正の領域と負の領域で対称」になるので、$x^2$で考える

  3. 山の頂点から端へ行くほどゼロに近づく(指数関数で山の傾斜を表す)

$$
\begin{eqnarray}
e^{-(x-\mu)^2}
\end{eqnarray}
$$

  4. 「正規分布から計算された平均と分散」と「この$f(x)$から計算された平均と分散」が一致するようにする

$$
\begin{eqnarray}
s^2 = \frac{1}{2 \sigma^2} \\
e^{-\frac{1}{2}\bigr( \frac{x - \mu}{\sigma} \bigl)^2}
\end{eqnarray}
$$

  5. グラフの面積が「1」になるように、$\sigma \sqrt{2 \pi}$ で割る



### 売上が40万以上になる確率を求める

* `pnorm()`関数:指定した平均と標準偏差に対する確率密度関数 $f(x)$ の累計確率を求める

```r
pnorm(
  q,
  mean = 0,
  sd = 1,
  lower.tail = TRUE,
  log.p = FALSE
)
```

| 引数         | 説明                     |
| ------------ | ------------------------ |
| `q`          | 累積確率を求めるベクトル |
| `mean`       | 平均                     |
| `sd`         | 標準偏差                 |
| `lower_tail` | `TRUE`で確率を求める     |
| `log.p`      | `FALSE`で確率を求める    |

    > 任意の正規分布において、`x`までの区間を積分区間として面積を求める

  * 最初の引数`x`:正規分布する任意のデータ

  * 2つ目の引数:正規分布の平均値

  * 3つ目の引数:標準偏差

```r
getSd <- function(x) {                  # 標本分散をもとに標準偏差を返す関数
  return(                               # 標準偏差を返す
    sqrt(                               # 分散の平方根
      sum((x - mean(x))^2) / length(x)) # 分散の計算式
  )
}

data <- read.table(                     # 売上状況.txtをdataに代入
  "売上状況.txt",
  header=T,                             # 1行目は列名であることを指定
  fileEncoding="CP932"                  # 文字コードをShift_JISに指定
)
# 必要なデータを用意
num <- data$売上額                      # 売上額のデータをベクトルに代入
sdv <- getSd(num)                       # 売上額の標準偏差を求める
seq <- seq(30, 60, by=5)                # 10～100までの5刻みのシーケンスを生成

# 累積確率を求める
cmp <- pnorm(
  seq,                                  # 累積確率を求めるデータ
  mean       = mean(data$売上額),       # 来店者数の平均
  sd         = sdv,                     # 来店者数の標準偏差
  lower.tail = TRUE                     # 累積確率を求める
  )

# 5万円刻みの売上額と累積確率のデータフレームを作成
cp_frm <- data.frame(
  "売上額"=seq,
  "累積確率"=cmp
  )
```

```r
> cp_frm
  売上額  累積確率
1     30 0.2468548
2     35 0.3940493
3     40 0.5583785
4     45 0.7131121
5     50 0.8359974
6     55 0.9183079
7     60 0.9648071
```

* 40万円をクリアできる確率は、確率全体の1から40万円に対する累積確率を引くことで求める

```r
> how = 1 - cp_frm[3,2]
> how
[1] 0.4416215
```



## 2. 偏差値の仕組み

* 偏差値:全員の平均点と標準偏差を基に、各人の得点を標準化した後、10倍して50を足したもの

  * 最後に`50`を足すことで、偏差値の値をマイナスにすることを防ぐ

$$
\begin{eqnarray}
偏差値 = \frac{X - \mu}{\sigma} \times 10 + 50
\end{eqnarray}
$$

```r
getSd <- function(x) {                  # 標準偏差を返す関数
  return(                               # 戻り値を返す
    sqrt(                               # 分散の平方根
      sum((x - mean(x))^2) / length(x)) # 分散の計算式
  )
}

data <- read.table(           # テスト結果.txtをdataに代入
  "テスト結果.txt",
  header=T,                   # 1行目は列名であることを指定
  fileEncoding="CP932"        # 文字コードをShift_JISに指定
)

num <- data$得点              # テスト結果の得点をベクトルに代入
sdv <- getSd(num)             # 得点の標準偏差を求める
men <- mean(num)              # 得点の平均
dev <-
  (data$得点-men) / sdv*10+50 # 全員の偏差値を求める

data <- cbind(                # 偏差値を追加したデータフレームを生成
  data,                       # もとのデータフレーム
  data.frame("偏差値" = dev)  # 偏差値のデータフレーム

  )
```

```r
> data
   得点   偏差値
1    87 63.08467
2    87 63.08467
3    84 60.77561
4    75 53.84843
5    78 56.15749
6    81 58.46655
7    51 35.37596
8    63 44.61220
9    63 44.61220

10   90 65.39373
11   48 33.06690
12   72 51.53937
13   48 33.06690
14   69 49.23031
15   57 39.99408
16   87 63.08467
17   54 37.68502
18   90 65.39373
19   78 56.15749
20   66 46.92125
21   66 46.92125
22   72 51.53937
23   78 56.15749
24   75 53.84843
25   57 39.99408
26   48 33.06690
27   57 39.99408
28   69 49.23031
29   81 58.46655
30   69 49.23031
```



### 標準偏差を用いた合格判定の仕組み

**平均が60点、標準偏差は10点の時、80点取ったら合格できる？**

* 定員:10名

* 受験人数:100名

80点は、平均点 $\mu$ を基準にすると「+20点」なので、標準偏差を用いて「$+2\sigma$」

> 上位約2.28%に含まれるので、定員が10名であれば十分に合格圏内

```r
> 1 - pnorm(80, mean=60, sd=10)
[1] 0.02275013
```



## 3. バラバラに分布するデータを正規分布に近似する(大数の法則)

> 省略



## 4. 正規分布の再生性

### 1. 正規分布の再生性

* 標準正規分布:平均 $\mu=0$ 、標準偏差 $\sigma = 1$ の分布

$$
\begin{eqnarray}
\mathcal{N}(0, 1^2)
\end{eqnarray}
$$

* 一般の正規分布:平均 $\mu$ 、標準偏差 $\sigma$ の分布

$$
\begin{eqnarray}
\mathcal{N}(\mu, \sigma^2)
\end{eqnarray}
$$

* 正規分布の再生性:正規分布を2つに重ね合わせても、分布の形が保存される

  * $X$:正規分布 $\mathcal{N}(\mu_1, \sigma_1^2)$

  * $Y$:正規分布 $\mathcal{N}(\mu_2, \sigma_2^2)$

$$
\begin{eqnarray}
\mathcal{N}(\mu_1+\mu_2,\sigma_1^2+\sigma_2^2)
\end{eqnarray}
$$



#### 2つのテストの平均と標準偏差を基に50位の人の合計得点を推計する

例題の点数

* 変量$X$:英語の点数

* 変量$Y$:数学の点数

英語と数学の合計点を表す変量 $X+Y$ は、

$$
\begin{eqnarray}
\mathcal{N}(45+65, 6^2+8^2) = \mathcal{N}(110, 10^2)
\end{eqnarray}
$$

* `qnorm()`関数:面積(累計確率)を指定すると、面積の区切りとなる $\sigma$ の割合を求める

```r
qnorm(
  q,
  mean = 0,
  sd = 1,
  lower.tail = TRUE,
  log.p = FALSE
)
```

| 引数         | 説明                                                                       |
| ------------ | -------------------------------------------------------------------------- |
| `q`          | 確率を求める面積                                                           |
| `mean`       | 平均                                                                       |
| `sd`         | 標準偏差                                                                   |
| `lower.tail` | `TRUE`(デフォルト)であれば、下側の確率を求める                             |
| `log.p`      | `FALSE`(デフォルト)ではなく`TRUE`であれば、確率`P`は対数値`log(P)`とされる |

```r
> qnorm(0.5+0.45, mean=0, sd=1)
[1] 1.644854
```

そうすると、 $\mathcal{N}(110, 10^2)$ の $\sigma^2$ は平均からの右半分($\sigma$)となる

```r
> 110 + (10 * 1.64)
[1] 126.4
```

よって、50位の人の英語と数学の合計点は、126点位であると考えられる



## 5. 点推定
