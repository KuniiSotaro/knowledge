01 Rの基本
=========

* `ベクトル`:何らかの値に名前を付ける仕組み

* `データ型`:

  * 基本データ型

  * クラス型

| 基本データ型の名前 | 種類     |
| ------------------ | -------- |
| `Numeric`          | 実数     |
| `Character`        | 文字列   |
| `Logical`          | 理論値   |
| `Complex`          | 複素数   |
| `Raw`              | バイナリ |
| `List`             | リスト   |

| クラス型の名前 | データの構造   |
| -------------- | -------------- |
| `Matrix`       | 行列           |
| `Array`        | 配列           |
| `Factor`       | 因子           |
| `data.frame`   | データフレーム |



## 1. ベクトルの基本

```r
> a <- 50 + 50
> a
[1] 100
```

別の値に同じベクトル名を付ける

```r
> b <- a
> b
[1] 100
> a
[1] 100
> b
[1] 100
```

新しい値に`a`という名前を付ける(再代入)

```r
> a <- 5
> a
[1] 5
> b
[1] 100
```



## 2. データ型の基本

* Rのデータ型は、大きく分けると

  * 基本データ型:ベクトルの仕組みを拡張し、ベクトル地震で扱えるようにした型(リテラル)

  * クラス型:独自の仕組みによって作られた型



### 基本形

* 基本データ型の基になる型

* 名前を付けて管理できる

| 基本型の名前 | 説明                                   |
| ------------ | -------------------------------------- |
| ベクトル型   | 同じモード型の値を複数持つことが出来る |
| 関数型       | 関数のためのソースコードを持つ         |



### モード型

* ベクトルに格納される値の種類を表す

> これらの型は、ベクトルの仕組みを拡張して作られている

| モード型の名前 | 種類     | リテラルの例                             |
| -------------- | -------- | ---------------------------------------- |
| `numeric`      | 実数     | `-1`, `1`, `1.23`                        |
| `character`    | 文字列   | "R言語", "集計表"                        |
| `logical`      | 理論値   | `TRUE`, `FALSE`                          |
| `complex`      | 複素数   | `1+1i`, `1+2i`, `1+3i`                   |
| `raw`          | バイナリ | `00 00 00`                               |
| `list`         | リスト   | 異なる基本データ型の値を持つことができる |

* モード型は、使用するメモリサイズに応じて動作モード(ストレージモード)が設定されている

* 実数型の`numeric`のみ、整数のみの値か小数を含む値かによって使用するメモリサイズが異なる

| モード型    | ストレージモード | 内容               |
| ----------- | ---------------- | ------------------ |
| `numeric`   | `integer`        | 整数               |
|             | `double`         | 倍精度浮動小数点数 |
|             | `single`         | 単精度浮動小数点数 |
| `character` | `character`      | 文字列             |
| `logical`   | `logical`        | 理論値             |
| `complex`   | `complex`        | 複素数             |
| `raw`       | `raw`            | バイナリデータ     |
| `list`      | `list`           | 異なる基本データ型 |



### クラス型

* 独自のクラスという仕組みで定義されている

| クラス型の名前 | データの構造   | 説明                                                                           |
| -------------- | -------------- | ------------------------------------------------------------------------------ |
| `matrix`       | 行列           | 同じモード型の値を持つ二次元のデータ構造                                       |
| `array`        | 配列           | 同じモード型の値を持つ二次元以上(多次元)のデータ構造                           |
| `factor`       | 因子           | 要素を整数値に置き換えて管理する。データサイズが大きくてもメモリ消費量が少ない |
| `data.frame`   | データフレーム | 異なるモード型の値を持つことができる二次元のデータ構造                         |



### データ型を確認する

* `is.vector()`:引数がベクトルであるかを調べる

* `mode()`:引数のモード型を調べる

* `storage.mode()`:引数の動作モードを調べる

* `class()`:引数のデータ型が定義されているクラスを調べる

```r
> a <- 1
> is.vector(a)
[1] TRUE
> mode(a)
[1] "numeric"
> storage.mode(a)
[1] "double"
> class(a)
[1] "numeric"
```



## 3. ベクトルを使いこなす

### ベクトルの作成と中身の取り出し方

* 演算子:ベクトルに値を代入する

```r
> n <- 100
> char <- "ベクトルです。"
```

* `c()`関数:ベクトルに対して、シーケンスを丸ごと代入する

```r
> n1 <- c(2, 3, 4)
> n1
[1] 2 3 4
> chr1 <- c("おはよう", "こんにちは", "わんばんこ")
> chr1
[1] "おはよう"   "こんにちは" "わんばんこ"
```

* `rm()`関数:ベクトルを削除

```r
> rm(n1)
> rm(chr1)
> n1
 エラー:  オブジェクト 'n1' がありません
> chr1
 エラー:  オブジェクト 'chr1' がありません
```

* `length()`関数:ベクトルの要素の個数を数える(ベクトルの長さ)

```r
> x <- c(10, 20, 30, 40, 50)
> length(x)
[1] 5
```



### ベクトルの要素の取り出しと置き換え

* ブラケット`[]`の中にインデックスの値を書くことで、特定の要素だけを取り出すことができる

  * ベクトルに代入された値は、それぞれ`1`から始まるインデックスであることに注意

```r
> a <- 1
> a
[1] 1
> a[1]
[1] 1
> a[2]
[1] NA
```

> `NA`:欠損値

* `[開始インデックス:終了インデックス]`のように指定することで、特定の範囲の要素をまとめて取り出すことができる

```r
> x <- c(10, 20, 30, 40, 50)
> x[2]
[1] 20
> x[2:4]
[1] 20 30 40
```

* ブラケットの中をベクトルにすることで、ベクトルの値がインデックスになる

```r
> x[c(1, 3, 5)]
[1] 10 30 50
```

* インデックスの値をマイナスにすることで、「その要素を除く」という意味になる

```r
> x[-1]
[1] 20 30 40 50
> x[c(-1, -3, -5)]
[1] 20 40
```

* 比較演算子は、以下の通り

  * `<`:「〜よりも大きい」値の要素を取り出す

  * `>`:「〜よりも小さい」値の要素を取り出す

```r

> x[30 < x]
[1] 40 50
> x[30 > x]
[1] 10 20
> x[10 < x & x < 40]
[1] 20 30
```



### ベクトルの要素を置き換える

> 要素が置き換えられると、同時に他の要素が全て文字列(`character`型)になることに注意する

```r
> x[5] <- 0
> x
[1] 10 20 30 40  0
> x[5] <- "hello"
> x
[1] "10"    "20"    "30"    "40"    "hello"
```



### ベクトルの結合と挿入

### ベクトルを結合して新しいベクトルを作る

* 2つ以上のベクトルを結合して1つにまとめるには、`c()`関数を使う

```r
> x <- c(1, 2, 3); y <- c(4, 5, 6); z <- c(7, 8, 9)
> a <- c(x, y, z)
> a
[1] 1 2 3 4 5 6 7 8 9
> b <- append(x, y)
> b
[1] 1 2 3 4 5 6
```

* `append()`関数:`after=`で指定したインデックスの直後の位置に別のベクトル要素を追加できる

```r
append(ベクトル, 結合するベクトル, after=インデックス)
```

```r
> c <- append(b, y, after=3)
> c
[1] 1 2 3 4 5 6 4 5 6
```



### ベクトルの要素に名前を付ける

* `names()`関数:ベクトルの要素はインデックス以外に、名前を付けて管理できる

```r
names(ベクトル) <- c("名前1", "名前2", ...)
```

```r
> num <- c(1, 2, 3, 4, 5, 6)
> names(num) <- c("one", "two", "three", "four", "five", "six")
> num
  one   two three  four  five   six
    1     2     3     4     5     6
> names(num)
[1] "one"   "two"   "three" "four"  "five"  "six"  
> num["one"]
one
  1
```

* 名前属性が設定されたベクトルは、`names()`関数で何度でも別の名前に変更できる

```r
> names(num) <- c("一", "二", "三", "四", "五", "六")
> num
一 二 三 四 五 六
 1  2  3  4  5  6
```

* 名前属性が不要になったら、名前属性に`NULL`を設定することで削除できる

```r
names(ベクトル) <- NULL
```

```r
> names(num) <- NULL
> num
[1] 1 2 3 4 5 6
```



### ベクトル同士の演算

| 演算子 | 意味   | 入力例    | 結果  |
| ------ | ------ | --------- | ----- |
| `+`    | 和     | `3 + 4`   | `7`   |
| `-`    | 差     | `3 - 1`   | `2`   |
| `*`    | 積     | `3 * 5`   | `15`  |
| `/`    | 商     | `9 / 2`   | `4.5` |
| `%/%`  | 整数商 | `9 %/% 2` | `4`   |
| `%%`   | 剰余   | `9 %% 2`  | `1`   |
| `^`    | 累乗   | `2 ^ 4`   | `16`  |

* `ベクトル+ベクトル`と書くと、ベクトルの要素ごとに順番に足し算が行われる

```r
> x <- c(1, 2, 3); y <- c(1, 2, 3)
> z <- x + y
> z
[1] 2 4 6
> z <- x * y
> z
[1] 1 4 9
```

* ベクトルの長さが異なる場合には、短い方のベクトルの要素が繰り返して使われる

  * ベクトルの全ての要素に、同じ処理を繰り返すことができる

```r
> x <- c(100, 100, 200, 200); y <- c(0.08, 1.08)
> z <- x * y
> z
[1]   8 108  16 216
```

* 1つのベクトルの全ての要素に対して、演算することができる

```r
> price <- c(1000, 2000, 3000)
> tax_in <- price * 1.08
> tax_in
[1] 1080 2160 3240
```

* 数列を作る記号`:`を使うことで、一定の規則に従った値を持つベクトルを作ることが出来る

```r
> x <- 1:5
> x
[1] 1 2 3 4 5
> y <- 5:-5
> y
 [1]  5  4  3  2  1  0 -1 -2 -3 -4 -5
> a <- rep(1:3, length=9)
> a
[1] 1 2 3 1 2 3 1 2 3
```



## 4. データ型の変換

### 関数を使ってデータ型を変換する

| 関数名           | 機能               |
| ---------------- | ------------------ |
| `as.numeric()`   | 実数に変換する     |
| `as.integer()`   | 整数に変換         |
| `as.character()` | 文字列に変換       |
| `as.logical()`   | 理論値に変換する   |
| `as.factor()`    | 順序なし因子に変換 |
| `as.ordered()`   | 順序あり因子に変換 |
| `as.complex()`   | 複素数に変換       |

```r
> data1 <- c("1.23", "20.34", "300.45")
> mode(data1)
[1] "character"
> conv1 <- as.numeric(data1)
> mode(conv1)
[1] "numeric"
> storage.mode(conv1)
[1] "double"
> conv1
[1]   1.23  20.34 300.45
> conv1 <- as.integer(conv1)
> mode(conv1)
[1] "numeric"
> storage.mode(conv1)
[1] "double"
> conv1
[1]   1.23  20.34 300.45
> conv1 <- as.integer(conv1)
> mode(conv1)
> conv1 <- as.integer(conv1)
> mode(conv1)
[1] "numeric"
> storage.mode(conv1()
+
> storage.mode(conv1)
[1] "integer"
> conv1
[1]   1  20 300
```



## 5. リスト

* `リスト`:リテラル、ベクトル、リスト自身を要素に、データを一つずつのシーケンスにまとめる

* Rでは、ベクトルやリストなどのプログラムで扱うデータのことを、`オブジェクト`と呼ぶ

  * リストでは、Rで扱うオブジェクトを1つにまとめて管理する

```r
list(要素1, 要素2, 要素3, ...)
```

```r
# 顧客id
id <- c(1:3)

# 名前
name <- list("秀和太郎",
             "築地花子",
             "宗田解析")

# 住所
add <- list("中央区築地100-1",
            "中央区築地本町200",
            "中央区日本橋99")

# リストを作成
add_book <- list("顧客リスト", id, name, add)
```

```r
> add_book
[[1]]         # 第一要素の中身
[1] "顧客リスト"

[[2]]         # 第二要素の中身
[1] 1 2 3


[[3]]         # 第三要素の中身
[[3]][[1]]    # リストの第一要素
[1] "秀和太郎"

[[3]][[2]]    # リストの第二要素
[1] "築地花子"

[[3]][[3]]    # リストの第三要素
[1] "宗田解析"


[[4]]         # 第四要素
[[4]][[1]]    # リストの第一要素
[1] "中央区築地100-1"

[[4]][[2]]    # リストの第二要素
[1] "中央区築地本町200"

[[4]][[3]]    # リストの第三要素
[1] "中央区日本橋99"
```



### リストの要素を取り出す

```r
リスト[[要素のインデックス]]
```
```r
# リスト要素の取り出し
list1 <- add_book[[1]]
list2 <- add_book[[2]]
list3 <- add_book[[3]]
list4 <- add_book[[4]]
```

```r
> list1
[1] "顧客リスト"
> list2
[1] 1 2 3
> list3
[[1]]
[1] "秀和太郎"

[[2]]
[1] "築地花子"

[[3]]
[1] "宗田解析"


> list4
[[1]]
[1] "中央区築地100-1"

[[2]]
[1] "中央区築地本町200"

[[3]]
[1] "中央区日本橋99"
```



### リスト要素のベクトルやリストの中からサブ要素を取り出す

```r
リスト[[要素のインデックス]][[サブ要素のインデックス]]
```

```r
# リスト要素の特定の要素を取り出す
cat1_id <- add_book[[2]][[1]]
cat1_name <- add_book[[3]][[1]]
cat1_add <- add_book[[4]][[1]]
```

```r
> cat1_id
[1] 1
> cat1_name
[1] "秀和太郎"
> cat1_add
[1] "中央区築地100-1"
```



### リスト要素をリストとして取り出す

```r
リスト[インデックス]
```

* 「新規に作成されたリストの中に格納」してから取り出される

```r
# リストの第1、第2要素をリストとして取り出す
var1 <- add_book[c(1, 2)]
```

```r
> var1
[[1]]
[1] "顧客リスト"     # 第1要素

[[2]]
[1] 1 2 3          # 第2要素
```

* `unlist()`関数:リストを削除して、その中身のベクトルだけにする

```r
# リストとして取得した要素をベクトルにする
var2 <- unlist(add_book[3])
```

```r
> var2
[1] "秀和太郎" "築地花子" "宗田解析"
> mode(var2)
[1] "character"
```



### リストの要素の変更と削除

* 代入演算子:リストの要素を変更する、再代入することで要素を書き換える

```r
# リストの要素を変更する
add_book[[3]][[1]] <- "築地太郎"
```

```r
> add_book[[3]][[1]]
[1] "築地太郎"
```

* リストの要素を削除するには、対象の要素に`NULL`を代入する

```r
リスト[[インデックス]] <- NULL
リスト[[インデックス]][[サブリストのインデックス]] <- NULL
```

```r
# リストの要素、サブリストの要素を削除する
add_book[[3]][[1]] <- NULL          # リストの第三要素、サブリストの第一要素を削除
add_book[[3]] <- NULL               # リストの第三要素を削除
```



### リスト要素を「名前=値」のペアで管理する

* 名前付き要素を持つリストを作る事もできる

```r
list(要素名1 = 値1, 要素名2 = 値2, ...)
```

* 値には、リテラル、ベクトル、リストを設定する

```r
add_book2 <- list(
                  id = c(1:3),
                  name = list("秀和太郎", "築地花子", "宗田解析"),
                  add = list("中央区築地100-1",
                             "中央区築地本町200",
                             "中央区日本橋99")
                  )
```

* 要素を取り出すには、

  * `[[]]`の内部に要素名を書く

  * `$`の次に要素名を書く

```r
リスト[[要素名]]
リスト $要素名
```

```r
> add_book2[["name"]]      # 名前付きリスト要素の取り出し
[[1]]
[1] "秀和太郎"

[[2]]
[1] "築地花子"

[[3]]
[1] "宗田解析"
> add_book2$"name"         # 名前付きリスト要素の取り出し
[[1]]
[1] "秀和太郎"

[[2]]
[1] "築地花子"

[[3]]
[1] "宗田解析"
> add_book2["name"]        # 名前付きリスト要素を名前付きで取り出し
$name
$name[[1]]
[1] "秀和太郎"

$name[[2]]
[1] "築地花子"

$name[[3]]
[1] "宗田解析"
> add_book2[["name"]][[1]]  # 名前付きリスト要素のサブ要素の取り出し
[1] "秀和太郎"
> add_book2[["name"]][1]    # 名前付きリストのサブ要素をリストに格納して取り出し
[[1]]
[1] "秀和太郎"
```
